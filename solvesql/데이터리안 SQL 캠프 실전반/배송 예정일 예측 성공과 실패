-- 1ì›” 8ì¼ê±°ê°€ ì—†ë‹¤ê³  í•´ì„œ í•œë²ˆ í…ŒìŠ¤íŠ¸ í•´ë´„, 6ê±´ ìˆë‹¤ê³  ë‚˜ì˜´
SELECT
  DATE(order_purchase_timestamp) AS "day",
  COUNT(order_id) AS "total"
FROM
  olist_orders_dataset
WHERE
  DATE(order_purchase_timestamp) = "2017-01-08";

-- ì‹¤íŒ¨í•œ ì¼€ì´ìŠ¤ ì¡°íšŒí•˜ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ ë‚˜ì˜´ ì™œëƒ nullê°’ 2ê°œë„ ì•ˆ ë‚˜ì˜¤ê³  ì„±ê³µí•œ 4ê°œë„ í¬í•¨ì´ ì•ˆë˜ë‹ˆê¹Œ
-- ê·¸ë ‡ë‹¤ë©´ ê·¸ëƒ¥ ì „ì²´ ì£¼ë¬¸ ìˆ˜ì—ì„œ ë¹¼ê¸°ë¥¼ í•˜ëŠ” ê²Œ ê°€ì¥ í¸í•˜ë‹¤
SELECT
  *
FROM
  olist_orders_dataset
WHERE
  DATE(order_purchase_timestamp) = "2017-01-09"
  AND (
    order_estimated_delivery_date < order_delivered_customer_date
  );

-- ì´ë ‡ê²Œ í•˜ë©´ ì„±ê³µ ê°œìˆ˜ ì˜ ë‚˜ì˜¤ëŠ”ë°
SELECT
  *
FROM
  olist_orders_dataset
WHERE
  DATE(order_purchase_timestamp) = "2017-01-08"
  and (
    order_estimated_delivery_date >= order_delivered_customer_date
  );

WITH
  succeess_data AS (
    -- 2017ë…„ 1ì›” í•œë‹¬ ë™ì•ˆì˜ ì„±ê³µ ë°ì´í„° ì¹´ìš´íŠ¸ í•˜ê¸°
    -- ì²˜ìŒì—ëŠ” having ì ˆì— order_estimated_delivery_date >= order_delivered_customer_date ì´ê±¸ ë„£ì—ˆëŠ”ë° ì•ˆë˜ì–´ì„œ 
    -- where ì ˆì— ë„£ìœ¼ë‹ˆ ì§„í–‰ë˜ëŠ” ê±°ë¡œ í™•ì¸
    SELECT
      DATE(order_purchase_timestamp) AS "day",
      COUNT(order_id) AS success
    FROM
      olist_orders_dataset
    WHERE
      DATE(order_purchase_timestamp) BETWEEN "2017-01-01" AND "2017-01-31"
      AND
      (order_estimated_delivery_date >= order_delivered_customer_date)
    GROUP BY
      DATE(order_purchase_timestamp)
  ),
  total_order AS (
    -- ì „ì²´ ì£¼ë¬¸ ìˆ˜ êµ¬í•˜ê¸°, order_delivered_customer_date NULL ê°’ì€ ì œì™¸í•´ì•¼ í•¨
    SELECT
      DATE(order_purchase_timestamp) AS "day",
      COUNT(order_id) AS "total"
    FROM
      olist_orders_dataset
    WHERE
      DATE(order_purchase_timestamp) BETWEEN "2017-01-01" AND "2017-01-31"
      AND order_delivered_customer_date IS NOT NULL
    GROUP BY
      DATE(order_purchase_timestamp)
  )
  -- ë¹¼ëŠ” ë°©ì•ˆìœ¼ë¡œ í’€ì–´ë´„, LEFT JOIN ìœ¼ë¡œ í•˜ë©´ ì™œ 1ì›”8ì¼êº¼ê°€ NULL NULL ë¡œ ë‚˜ì˜¤ì§€?
SELECT
  a.day AS "purchase_date",
  b.success,
  (a.total - b.success) AS fail
FROM
  total_order a LEFT
  JOIN succeess_data b on a.day = b.day;

'''
## ìƒê°í•´ë³´ê¸° : HAVING ì ˆì—ëŠ” í•˜ë‚˜í•˜ë‚˜ì˜ ê°œë³„ í–‰ ì¡°ê±´ì´ ì•„ë‹Œ GROUP ì¦‰ ì§‘ê³„ í•¨ìˆ˜ì˜ ì¡°ê±´ë§Œ ë„£ì„ ìˆ˜ ìˆë‹¤.
WHEREì— 
order_estimated_delivery_date >= order_delivered_customer_date
ì´ê±¸ ë„£ëŠ” ê²ƒê³¼ HAVINGì— ë„£ëŠ” ê±°ê³¼ì˜ ì°¨ì´ëŠ” ë¬´ì—‡ì¼ê¹Œ?

âŒ ì´ ì¿¼ë¦¬ëŠ” ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥ì„± ìˆìŒ âŒ
(SQLite, MySQL ë“±ì—ì„œëŠ” ì‹¤í–‰ë˜ì§€ ì•Šê±°ë‚˜ ë…¼ë¦¬ì ìœ¼ë¡œ ì´ìƒí•œ ê²°ê³¼ê°€ ë‚˜ì˜´)

ì™œ ë¬¸ì œê°€ ë°œìƒí• ê¹Œ?
HAVINGì€ GROUP BY ì´í›„ ì‹¤í–‰ë˜ë¯€ë¡œ, HAVINGì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì§‘ê³„ëœ ê²°ê³¼ì—¬ì•¼ í•¨.
í•˜ì§€ë§Œ order_estimated_delivery_date >= order_delivered_customer_dateëŠ” ê° ê°œë³„ í–‰ì— ëŒ€í•œ ì¡°ê±´.
HAVINGì€ COUNT(order_id), SUM(price) ê°™ì€ ì§‘ê³„ í•¨ìˆ˜ ê²°ê³¼ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§í•  ë•Œ ì‚¬ìš©í•´ì•¼ í•¨.
ğŸ”¹ ì¦‰, HAVINGì—ì„œëŠ” COUNT(order_id) >= 10 ê°™ì€ ì§‘ê³„ í•¨ìˆ˜ ê¸°ë°˜ ì¡°ê±´ì„ ì ìš©í•´ì•¼ í•˜ì§€ë§Œ, ê°œë³„ í–‰ ì¡°ê±´ì¸ order_estimated_delivery_date >= order_delivered_customer_dateë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ.
'''
